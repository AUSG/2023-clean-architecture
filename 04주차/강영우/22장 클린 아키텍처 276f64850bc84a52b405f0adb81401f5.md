# 22장 클린 아키텍처

- 다양한 아키텍처가 연구되었지만 핵심은 “관심사의 분리”다.
- 관심사의 분리를 중점으로 한 아키텍처들은 다음과 같은 특징을 가졌다.
    - 프레임워크 독립성
    - 테스트 용이성
    - UI 독립성
    - 데이터페이스 독립성
    - 모든 외부 에이전시에 대한 독립성

![Untitled](22%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20276f64850bc84a52b405f0adb81401f5/Untitled.png)

# 의존성 규칙

---

- 위 사진에서 안쪽으로 갈수록 고수준의 소프트웨어이다.
    - 바깥쪽 원: 메커니즘
    - 안쪽 원: 정책
- 내부의 원에 속한 요소는 외부의 원에 속한 어떤 것도 알지 못한다.

## 엔티티

- 엔티티는 전사적인 핵심 업무 규칙을 캡슐화한다.
- 외부의 어떤 변화가 생기더라도 엔티티가 변경될 가능성은 아주 적다.
- 운영 관점에서 특정 애플리케이션에 변경이 필요하더라도 엔티티 계층에는 절대로 영향을 주어서는 안된다.

## 유스케이스

- 유스케이스 계층의 소프트웨어는 애플리케이션에 특화된 업무 규칙을 포함한다.
- 시스템의 모든 유스케이스를 캡슐화하고 구현한다.
- 데이터 흐름을 조정한다.
- 이 계층에서 생긴 변경이 엔티티에 영향을 줘서는 안된다.
- 외부 계층에서 생긴 변경이 유스케이스 계층에 영향을 줘서도 안된다.

## 인터페이스 어댑터

- 일련의 어댑터들로 구성됨
- 어댑터는 데이터를 유스케이스와 엔티티에게 가장 편리한 형식에서 데이터베이스나 웹 같은 외부 에이전시에게 가장 편리한 형식으로 변환된다.
- MVC 아키텍처는 이 계층에 속한다.
    - Presenter, view, controller 모두 이 인터페이스 어댑터 계층에 속한다.
- 이 원안에 속한 어떤 코드도 외부에 대해 조금도 알아서는 안된다.

## 프레임워크와 드라이버

- 모든 세부사항이 위치하는 곳이다. 외부에 위치시켜서 피해를 최소화 한다.

## 원은 네 개여야만 하나?

- 더 많은 원이 필요할 수 있다.
- 중요한 것은 의존성 규칙 적용.

## 경계 횡단하기

- 제어흐름과 의존성의 방향이 명백히 반대여야 하는 경우, 의존성 역전 원칙을 사용해 해결한다.

## 경계를 횡단하는 데이터는 어떤 모습인가.

- 흔히 간단한 데이터 구조로 이루어져 있다.
- 경계를 횡단하는 데이터는 격리되어 있는 간단한 데이터 구조가 경계를 가로질러 전달된다.
- 경계를 가로질러 데이터를 전달할 때, 데이터는 항상 내부의 원에서 사용하기 가장 편리한 형태를 가져야 한다.

# 전형적인 시나리오

---

![Untitled](22%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20276f64850bc84a52b405f0adb81401f5/Untitled%201.png)

- 모든 의존성은 경계선을 안쪽으로 가로지르며, 의존성 규칙을 준수한다.

# 결론

---

소프트웨어를 계층으로 분리하고 의존성 규칙을 준수한다면 본질적으로 테스트하기 쉬운 시스템을 가지게 된다.