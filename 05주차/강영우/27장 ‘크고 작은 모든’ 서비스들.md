# 27장 ‘크고 작은 모든’ 서비스들

- 서비스 지향 아키텍처와 마이크로서비스 아키텍처가 인기있는 이유
    - 서비스를 사용하면 상호 결합이 철저하게 분리되는 것처럼 보인다.
    - 서비스를 사용하면 개발과 배포 독립성을 지원하는 것처럼 보인다.
- 둘 다 맞는 말이지만 일부만 맞는 말이다.

# 서비스 아키텍처?

---

- 서비스를 사용한다는 것은 아키텍처에 해당되지 않는다.
    - 서비스를 단순히 사용하는 것은 그냥 함수 호출에 지나지 않는다.
- 서비스는 프로세스나 플랫폼 경계를 가로지르는 함수 호출에 지나지 않는다. 중요하거나, 중요하지 않지만 중요한 서비스에 집중한다.

# 서비스의 이점?

---

## 결합 분리의 오류

- 시스템을 서비스들로 분리함으로써 얻게 되는 큰 이점은 서비스 사이의 결합이 확실히 분리된다는 점이다.
- 각 서비스는 다른 서비스의 변수에 직접 접근이 불가능하고, 인터페이스도 잘 정의되어있어야 한다.
- 개별 변수 수준에서는 결합이 분리되지만, 프로세스 내 또는 네트워크 상의 공유 자원 때문에 결합될 가능성이 존재한다. 서로 공유되는 데이터가 있다면 더욱 강력하게 결합되어 버린다.
- 인터페이스가 잘 정의되어야 한다는 이점에 대해서는 진실이지만, 함수도 다르지 않다.

## 개발 및 배포 독립성의 오류

- 다른 이점은 전담팀이 해당 서비스를 소유하고 운영한다는 점이다.
    - 이런 개발 및 배포 독립성은 확장 가능한 것으로 간주된다.
- 모노리틱 시스템이나 컴포넌트 기반 시스템으로도 구축할 수 있다. (서비스만이 답이 아니다.)
- 서비스라고 항상 독립적으로 개발/배포/운영 할 수 있는 것이 아니다. 데이터나 행위에 묶여있다면 조정해야한다.

# 야옹이 문제

---

- 택시 통합 시스템을 확장 가능한 시스템을 구축하고 싶었기에 마이크로서비스를 기반으로 구축했다고 치자.
- 고양이를 운송하는 기능이 추가될 때 많은 것을 고려해야 한다. 실질적으로 배차, 택시 선택 등은 서로 결합되어있다.
- 횡단 관심사가 지닌 문제: 기능적 분해는 새로운 기능이 기능적 행위를 횡단하는 상황에 매우 취약하다.

# 객체가 구출하다.

---

- 컴포넌트 기반 아키텍처에서는 배차와 관련된 로직과 고양이에 대한 기능을 분리하고, 기존 컴포넌트들에 있는 추상 기반 클래스를 템플릿 메서드나 전략 패턴을 이용해서 오버라이드 한다.
- 객체로도 멋지게 해결 가능하다.

# 컴포넌트 기반 서비스

---

- 위 예제를 서비스에 적용할 수 있다. 새로운 기능 또는 확장을 기존 정의된 서비스들을 확장해서 만들어진다. 그러면 재배포하는 것이 아닌 단순히 새로운 서비스를 추가하는 형태가 된다. 이런 행위들은 개방 폐쇄원칙을 준수하게 된다.

# 횡단 관심사

---

- 아키텍처 경계가 서비스 사이에 있지 않다.
- 직면하는 횡단 관심사를 처리하려면 서비스 내부는 의존성 규칙도 준수하는 컴포넌트 아키텍처로 설계해야 한다.
- 아키텍처 경계를 정의하는 것은 서비스가 아닌 서비스 내 위치한 컴포넌트이다.

# 결론

---

- 서비스가 무조건 옳은 것은 아니다.